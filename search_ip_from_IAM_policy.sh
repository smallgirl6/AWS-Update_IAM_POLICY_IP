aws iam list-policies --scope Local --output json \ | jq -r '.Policies[] | [.Arn, .DefaultVersionId] | @tsv' \ | while IFS=$'\t' read -r arn ver; do aws iam get-policy-version --policy-arn "$arn" --version-id "$ver" \ --query 'PolicyVersion.Document' --output json \ | jq -r ' [ .. | objects | .Condition? // {} | objects | to_entries[]? | select(.key | test("IpAddress$"; "i")) | .value | if type=="object" then .["aws:SourceIp"] else empty end | if type=="array" then . else [.] end | .[]? | tostring ] as $ips | ( any($ips[]?; .=="1.2.3.4/28" or .=="3.3.3.3/28") | tostring ) ' | grep -qx 'true' && echo "$arn" done